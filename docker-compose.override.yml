# Docker Compose override for intelligent incremental watcher
# This uses the new intelligent_watcher.py for incremental indexing
# Copy this to docker-compose.override.yml to enable intelligent watching

services:
  # Intelligent incremental watcher
  watcher:
    build:
      context: .
    restart: always
    command: >
      /app/.venv/bin/python3 /app/scripts/watcher.py
      --watch-dir /app/markdown_files
      --base-url http://rag-api:8000
      --allowed-extensions ${ALLOWED_EXTENSIONS:-md,markdown,txt,pdf,docx,pptx,html,htm,csv,png,jpg,jpeg,tiff,tif,eml,emlx}
      --debounce ${WATCHER_DEBOUNCE:-5}
      --poll-interval ${WATCHER_POLL_INTERVAL:-5}
      --wait-stable ${WATCHER_WAIT_STABLE:-2}
      --bulk-threshold ${WATCHER_BULK_THRESHOLD:-10}
      --timeout ${WATCHER_TIMEOUT:-1200}
      --sync-interval ${WATCHER_SYNC_INTERVAL:-3600}
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./scripts:/app/scripts:ro
      - ${MARKDOWN_DOCS_PATH:-./markdown_docs}:/app/markdown_files:ro
    depends_on:
      - rag-api